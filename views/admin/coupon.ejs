<%- include('../layouts/adminHeader.ejs') %>

<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Coupons</h2>
        </div>
        <a href="/admin/addCoupon">
            <button type="submit" class="btn btn-md rounded font-sm hover-up">Add Coupon</button>
        </a>
    </div>
    <div class="card mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Coupon ID</th>
                            <th>Description</th>
                            <th>Offer Price</th>
                            <th>Minimum Amount</th>
                            <th>Expiry Date</th>
                            <th class="text-end">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(coupon.length > 0) { %>
                            <% coupon.forEach(couponItem => { %>
                                <tr>
                                    <td><%= couponItem.couponId %></td>
                                    <td><%= couponItem.description %></td>
                                    <td><%= couponItem.offerPrice %></td>
                                    <td><%= couponItem.minimumAmount %></td>
                                    <td><%= couponItem.expiryDate %></td>
                                    <td class="text-end">
                                        <a class="mx-5"  onclick="confirmDelete('<%= couponItem._id %>')">
                                            <button type="button" class="btn btn-danger">DELETE</button>
                                        </a>
                                        <a href="/admin/editCoupon?id=<%= couponItem._id %>"
                                           class="btn btn-md rounded font-sm">Edit</a>
                                    </td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="6">No coupons found</td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div> <!-- table-responsive//end -->
        </div>
        <!-- card-body end// -->
    </div>
</section>

<script>
    function confirmDelete(couponId) {
    Swal.fire({
        title: 'Confirm Deletion',
        text: 'Are you sure you want to delete this address?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, Delete Address',
        cancelButtonText: 'Cancel',
    }).then((result) => {
        if (result.isConfirmed) {
            
            $.ajax({
                url: '/admin/deleteCoupon/' + couponId,
                type: 'GET',
                contentType: 'application/json',
                success: function (data) {
                    if (data.success) {
                        // Show success message
                        Swal.fire({
                            icon: 'success',
                            title: 'Address Deleted Successfully!',
                            text: 'Click OK to proceed.',
                            confirmButtonText: 'OK',
                        }).then((result) => {
                            if (result.isConfirmed) {
                              window.location.reload();
                            }
                        });
                    } else {
                        // Show error message
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Error occurred while deleting address.',
                        });
                    }
                },
                error: function (error) {
                    console.error('Error:', error);

                    // Show error message
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Error occurred while deleting address. Check the console for details.',
                    });
                }
            });
        }
    });
}

</script>

<%- include('../layouts/adminFooter.ejs') %>
