<%- include('../layouts/userHeader') %>
  <main class="main">
    <div class="page-header breadcrumb-wrap">
      <div class="container">
        <div class="breadcrumb">
          <a href="ind" rel="nofollow">Home</a>
          <span></span> Shop
        </div>
      </div>
    </div>
    <section class="mt-50 mb-50">
      <div class="container">
        <div class="row flex-row-reverse">
          <div class="col-lg-9">
            <div class="shop-product-fillter">
              <div class="totall-product">
                <p> We found <strong class="text-brand">
                    <%= products.length %>
                  </strong> items for you!</p>
              </div>
              <div class="sort-by-product-area">
                <div class="sort-by-cover mr-10">

                </div>
                <div class="sort-by-cover">
                  <div class="sort-by-product-wrap">
                    <div class="sort-by">
                      <span><i class="fi-rs-apps-sort"></i>Sort by:</span>
                    </div>
                    <div class="sort-by-dropdown-wrap">
                      <span> Featured <i class="fi-rs-angle-small-down"></i></span>
                    </div>
                  </div>
                  <div class="sort-by-dropdown">
                    <ul>
                      <li><a class="active" href="/items">Featured</a></li>
                      <li><a href="/items?sort=asc">Price: Low to High</a></li>
                      <li><a href="/items?sort=dsc">Price: High to Low</a></li>

                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="row product-grid-3" id="productGrid">

              <% if (products.length> 0) {



                %>

                <% for(const product of products){%>

                  <div class="col-lg-4 col-md-4 col-12 col-sm-6 my-3">
                    <div class="product-cart-wrap mb-30 h-100">
                      <div class="product-img-action-wrap">
                        <div class="product-img product-img-zoom">
                          <a href="/single-items?id=<%= product._id %>">
                            <img class="default-img" src="/assets/imgs/productIMG/<%= product.image[0] %>" alt="">
                            <img class="hover-img" src="/assets/imgs/productIMG/<%= product.image[1] %>" alt="">
                          </a>
                        </div>

                        <div class="product-badges product-badges-position product-badges-mrg">
                          <span class="hot">Hot</span>
                        </div>
                      </div>
                      <div class="product-content-wrap">
                        <div class="product-category">
                          <a href="shop-grid-right.html">bag</a>
                        </div>
                        <h2><a href="shop-product-right.html">
                            <%= product.name %>
                          </a></h2>
                        <div class="rating-result" title="90%">
                          <span>
                            <span>90%</span>
                          </span>

                        </div>
                        <div class="product-price">
                          <span>
                            <%= product.offerPrice %>
                          </span>
                          <span class="old-price">
                            <%= product.price %>
                          </span>

                        </div>

                      </div>

                      <% if(product.stock==0){ %>

                        <p class="text-danger">Out Of Stock</p>

                        <%}%>


                    </div>

                  </div>



                  <% } %>
                    <% } else { %>
                      <tr>
                        <td colspan="6">
                          <p>Product not found</p>
                        </td>
                      </tr>
                      <% } %>
                        <div id="no_product" style="display: none;">PRODUCT NOT FOUND</div>



            </div>
            <!--pagination-->
            <div class="pagination-area mt-15 mb-sm-5 mb-lg-0">
              <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-start">
                  <% for (let i=1; i <=totalPages; i++) { %>
                    <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                      <a class="page-link" href="?page=<%= i %>">
                        <%= i %>
                      </a>
                    </li>
                    <% } %>
                      <li class="page-item">
                        <a class="page-link dot" href="#">...</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="?page=<%= totalPages %>">
                          <%= totalPages %>
                        </a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#"><i class="fi-rs-angle-double-small-right"></i></a>
                      </li>
                </ul>
              </nav>
            </div>

          </div>
          <div class="col-lg-3 primary-sidebar sticky-sidebar">
            <div class="widget-category mb-30">
              <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>
              <ul class="categories">
                <% for(const categories of category) {%>
                  <li><a href="/items/?categoryName=<%= categories._id  %>">
                      <%= categories.name %>
                    </a></li>
                  <% } %>
              </ul>
            </div>
            <!-- Fillter By Price -->


            <div class="sidebar-widget price_range range mb-30">
              <form id="priceFilterForm">
                <div class="widget-header position-relative mb-20 pb-10">
                  <h5 class="widget-title mb-10">Filter by Price</h5>
                  <div class="bt-1 border-color-1"></div>
                </div>
                <div class="price-filter">
                  <div class="price-filter-inner">
                    <!-- Price range table -->
                    <table>
                      <tr>
                        <td><label for="range1">₹0 - ₹1000</label></td>
                        <td><input type="radio" name="price_range" id="range1" class="small-radio" value="range1"></td>
                      </tr>
                      <tr>
                        <td><label for="range2">₹1000 - ₹2000</label></td>
                        <td><input type="radio" name="price_range" id="range2" class="small-radio" value="range2"></td>
                      </tr>
                      <tr>
                        <td><label for="range3">₹2000 - ₹5000</label></td>
                        <td><input type="radio" name="price_range" id="range3" class="small-radio" value="range3"></td>
                      </tr>
                      <tr>
                        <td><label for="range4">₹5000 above</label></td>
                        <td><input type="radio" name="price_range" id="range4" class="small-radio" value="range4"></td>
                      </tr>
                      <!-- Add more rows as needed -->
                    </table>
                  </div>
                </div>
                <button type="button" class="btn btn-sm btn-default" onclick="applyFilter()">Filter</button>
              </form>
            </div>







            <!-- Product sidebar Widget -->


          </div>
        </div>
      </div>
    </section>
  </main>

  <style>
    /* Add this style to make radio buttons smaller */
    .small-radio {
      width: 16px;
      height: 16px;
    }
  </style>

  <script>


    document.addEventListener("DOMContentLoaded", function () {
      const searchInput = document.getElementById("searchProducts");
      const productGrid = document.getElementById("productGrid");
      const products = productGrid.getElementsByClassName("col-lg-4"); // Assuming each card is within a div with class "col-lg-4"
      const no_product = document.getElementById("no_product");

      searchInput.addEventListener("input", function () {
        const searchText = searchInput.value.toLowerCase();

        for (let i = 0; i < products.length; i++) {
          const productName = products[i].querySelector("h2 a").textContent.toLowerCase();

          if (!searchText || productName.includes(searchText)) {
            products[i].style.display = "";
            no_product.style.display = "none";

          } else {
            products[i].style.display = "none";
            no_product.style.display = "";

          }
        }
      });
    });

  </script>
  <script>
  async function fetchFilteredProducts(selectedRange) {
    try {
      const response = await fetch('/filterPrice', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ price_range: selectedRange }),
      });

      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      const filteredProducts = await response.json();
      displayFilteredProducts(filteredProducts);
    } catch (error) {
      console.error('Error fetching filtered products:', error);
    }
  }

  function displayFilteredProducts(filteredProducts) {
  const container = document.getElementById('productGrid');

  // Clear existing content
  container.innerHTML = '';

  if (filteredProducts.length === 0) {
    container.innerHTML = '<p>No products found for the selected range.</p>';
  } else {
    filteredProducts.forEach(product => {
      const productDiv = document.createElement('div');
      productDiv.classList.add('col-lg-4', 'col-md-4', 'col-12', 'col-sm-6', 'my-3');
      productDiv.innerHTML = `
        <div class="product-cart-wrap mb-30 h-100">
          <div class="product-img-action-wrap">
            <div class="product-img product-img-zoom">
              <a href="/single-items?id=${product._id}">
                <img class="default-img" src="/assets/imgs/productIMG/${product.image[0]}" alt="">
                <img class="hover-img" src="/assets/imgs/productIMG/${product.image[1]}" alt="">
              </a>
            </div>
            <div class="product-badges product-badges-position product-badges-mrg">
              <span class="hot">Hot</span>
            </div>
          </div>
          <div class="product-content-wrap">
            <div class="product-category">
              <a href="shop-grid-right.html">bag</a>
            </div>
            <h2><a href="shop-product-right.html">${product.name}</a></h2>
            <div class="rating-result" title="90%">
              <span><span>90%</span></span>
            </div>
            <div class="product-price">
              <span>${product.offerPrice}</span>
              <span class="old-price">${product.price}</span>
            </div>
          </div>
        </div>
      `;

      container.appendChild(productDiv);
    });
  }
}

  function applyFilter() {
  const selectedRange = document.querySelector('input[name="price_range"]:checked');
  console.log('Selected Range:', selectedRange ? selectedRange.value : 'None');
  if (selectedRange) {
    fetchFilteredProducts(selectedRange.value);
  } else {
    console.log('Please select a price range');
  }
}

</script>



  <%- include('../layouts/userFooter') %>